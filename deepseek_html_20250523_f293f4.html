<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIRILE | AI Looksmaxing for Men</title>
    <style>
        :root {
            --primary: #1E40AF;
            --dark: #111827;
            --accent: #F59E0B;
            --light: #F3F4F6;
        }
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            color: var(--dark);
            background-color: white;
        }
        header {
            background: linear-gradient(135deg, var(--dark), var(--primary));
            color: white;
            padding: 2rem 1rem;
            text-align: center;
        }
        .logo {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
        }
        .cta-button {
            background: var(--accent);
            color: var(--dark);
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.1rem;
            transition: transform 0.2s;
        }
        .cta-button:hover {
            transform: scale(1.05);
        }
        .cta-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        #ai-scan-container {
            max-width: 600px;
            margin: 2rem auto;
            padding: 2rem;
            border: 1px solid #ddd;
            border-radius: 12px;
            text-align: center;
        }
        #image-container {
            position: relative;
            margin: 1rem auto;
            width: 300px;
            height: 300px;
        }
        #uploaded-image {
            max-width: 100%;
            max-height: 100%;
            border-radius: 8px;
            display: none;
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
        #scan-result {
            margin-top: 1rem;
            text-align: left;
        }
        .loading-container {
            margin: 1rem 0;
        }
        .loading-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        .loading-progress {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s;
        }
        .loading-text {
            font-weight: bold;
            color: var(--primary);
        }
        .scan-animation {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background: linear-gradient(
                rgba(245, 158, 11, 0.1),
                rgba(245, 158, 11, 0.3)
            );
            animation: scan 2s infinite;
            display: none;
        }
        @keyframes scan {
            0% { top: -100%; }
            100% { top: 100%; }
        }
        .product-card {
            background: var(--light);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: flex;
            align-items: center;
        }
        .product-card img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 1rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">VIRILE</div>
        <h1>Maximize Your Looks, Style & Confidence</h1>
        <p>AI-powered looksmaxing for the modern man</p>
        <button class="cta-button" onclick="startScan()">Start Free Scan</button>
    </header>

    <div id="ai-scan-container" style="display: none;">
        <h2>AI Facial Scan</h2>
        <p>Upload a clear selfie (front-facing, good lighting):</p>
        <input type="file" id="selfie-upload" accept="image/*" onchange="loadImage()">
        
        <div id="image-container">
            <div id="scan-animation" class="scan-animation"></div>
            <img id="uploaded-image" alt="Uploaded preview">
            <canvas id="overlay"></canvas>
        </div>
        
        <div class="loading-container" id="loading-container" style="display: none;">
            <div class="loading-bar">
                <div class="loading-progress" id="loading-progress"></div>
            </div>
            <p class="loading-text" id="loading-text">ASCEND COMMENCING...</p>
        </div>
        
        <div id="scan-result"></div>
    </div>

    <!-- Load Face-api.js -->
    <script src="https://justadudewhohacks.github.io/face-api.js/face-api.js"></script>
    <script>
        // Preload models for faster detection
        let modelsLoaded = false;
        async function loadModels() {
            if (modelsLoaded) return;
            
            document.getElementById('loading-container').style.display = 'block';
            document.getElementById('loading-text').textContent = "LOADING AI MODELS...";
            updateProgressBar(10);
            
            await Promise.all([
                faceapi.nets.tinyFaceDetector.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models'),
                faceapi.nets.faceLandmark68Net.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models')
            ]);
            
            updateProgressBar(100);
            setTimeout(() => {
                document.getElementById('loading-container').style.display = 'none';
            }, 500);
            
            modelsLoaded = true;
            console.log("Models loaded");
        }
        
        // Initialize models when page loads
        loadModels();

        function startScan() {
            document.getElementById('ai-scan-container').style.display = 'block';
            window.scrollTo(0, document.getElementById('ai-scan-container').offsetTop);
        }

        function loadImage() {
            const file = document.getElementById('selfie-upload').files[0];
            const container = document.getElementById('image-container');
            
            if (!file) return;
            
            container.innerHTML = `
                <div id="scan-animation" class="scan-animation"></div>
                <img id="uploaded-image" alt="Uploaded preview">
                <canvas id="overlay"></canvas>
            `;
            
            const img = document.getElementById('uploaded-image');
            img.onload = () => {
                img.style.display = 'block';
                detectFace(img);
            };
            img.src = URL.createObjectURL(file);
        }

        function updateProgressBar(percent) {
            const progressBar = document.getElementById('loading-progress');
            progressBar.style.width = `${percent}%`;
        }

        async function detectFace(img) {
            const resultDiv = document.getElementById('scan-result');
            const loadingContainer = document.getElementById('loading-container');
            const scanAnimation = document.getElementById('scan-animation');
            
            // Show loading UI
            resultDiv.innerHTML = '';
            loadingContainer.style.display = 'block';
            scanAnimation.style.display = 'block';
            document.getElementById('loading-text').textContent = "ASCEND COMMENCING...";
            
            // Simulate progress for better UX
            updateProgressBar(20);
            
            // Detect face with timeout for better performance
            let detections;
            try {
                detections = await Promise.race([
                    faceapi.detectAllFaces(img, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks(),
                    new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 3000))
                ]);
            } catch (e) {
                loadingContainer.style.display = 'none';
                scanAnimation.style.display = 'none';
                resultDiv.innerHTML = '<p>Analysis took too long. Try a clearer photo.</p>';
                return;
            }
            
            updateProgressBar(60);
            
            if (!detections || detections.length === 0) {
                loadingContainer.style.display = 'none';
                scanAnimation.style.display = 'none';
                resultDiv.innerHTML = '<p>No face detected. Try another photo.</p>';
                return;
            }

            // Draw results
            const canvas = document.getElementById('overlay');
            faceapi.matchDimensions(canvas, img);
            faceapi.draw.drawFaceLandmarks(canvas, detections[0]);
            
            updateProgressBar(90);
            
            // Generate analysis
            setTimeout(() => {
                generateAnalysisReport(detections[0].landmarks);
                loadingContainer.style.display = 'none';
                scanAnimation.style.display = 'none';
                updateProgressBar(100);
            }, 500);
        }

        function generateAnalysisReport(landmarks) {
            const resultDiv = document.getElementById('scan-result');
            
            // Feature extraction
            const jawline = landmarks.getJawOutline();
            const eyebrows = landmarks.getLeftEyeBrow().concat(landmarks.getRightEyeBrow());
            const lips = landmarks.getMouth();
            
            // Analysis logic (simplified)
            const jawlineScore = Math.min(100, 70 + Math.floor(Math.random() * 30)); // Mock score
            const eyebrowScore = Math.min(100, 60 + Math.floor(Math.random() * 40));
            const lipScore = Math.min(100, 80 + Math.floor(Math.random() * 20));
            
            // Product recommendations
            const products = [
                {
                    name: "The Alpha Jawline Trainer",
                    description: "Strengthen your jaw muscles with 10 minutes daily use",
                    price: "$29.99",
                    image: "https://via.placeholder.com/80/1E40AF/FFFFFF?text=JAWLINE"
                },
                {
                    name: "Prime Brow Gel",
                    description: "Tame and shape eyebrows for a sharper look",
                    price: "$14.99",
                    image: "https://via.placeholder.com/80/1E40AF/FFFFFF?text=EYEBROW"
                },
                {
                    name: "Elite Lip Balm",
                    description: "Hydrate and plump lips with vitamin E",
                    price: "$9.99",
                    image: "https://via.placeholder.com/80/1E40AF/FFFFFF?text=LIP+CARE"
                }
            ];
            
            // Build results HTML
            let html = `
                <h3>YOUR VIRILE ANALYSIS</h3>
                <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <p><strong>Facial Feature Scores:</strong></p>
                    <ul>
                        <li>Jawline Definition: ${jawlineScore}/100</li>
                        <li>Eyebrow Symmetry: ${eyebrowScore}/100</li>
                        <li>Lip Fullness: ${lipScore}/100</li>
                    </ul>
                </div>
                
                <h4>ðŸ”§ Recommended Improvements</h4>
                <ol>
                    <li><strong>Jawline:</strong> Perform chewing exercises 2x/day</li>
                    <li><strong>Eyebrows:</strong> Trim and shape every 2 weeks</li>
                    <li><strong>Lips:</strong> Exfoliate 2x/week and use SPF balm</li>
                </ol>
                
                <h4>ðŸ›’ Recommended Products</h4>
            `;
            
            products.forEach(product => {
                html += `
                    <div class="product-card">
                        <img src="${product.image}" alt="${product.name}">
                        <div>
                            <strong>${product.name}</strong>
                            <p>${product.description}</p>
                            <p style="color: var(--accent); font-weight: bold;">${product.price}</p>
                        </div>
                    </div>
                `;
            });
            
            html += `<button class="cta-button" style="margin-top: 1rem;">GET YOUR PERSONALIZED PLAN ($29/month)</button>`;
            
            resultDiv.innerHTML = html;
        }
    </script>
</body>
</html>